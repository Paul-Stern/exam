<!DOCTYPE html>
<html lang="ru-RU">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <title>Тестирование ЯОКБ</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
            rel="stylesheet"
            integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
            crossorigin="anonymous">
</head>
<body>
    <div class="progress" role="progressbar">
        <div id="progress-bar" class="progress-bar" style="width: 0"></div>
    </div>
    <div class="container">
        <h3 class="text-secondary">Тестирование по теме "Общая эрудиция"</h3>
        <h6 class="text-secondary">Работник: {{.User}}</h6>
    <form action="/test" method="post">
        {{range $i, $card := .Cards}}
        <div class="js-card{{if eq $i 0}} js-current{{else}} d-none{{end}}">
            <h1>Вопрос №{{$card.Id}}</h1>
            <h2>{{$card.Question}}</h2>
            <ol>
                {{range $j, $o := $card.Options}}
                <h5>
                <li>
                    <div class="form-check">
                        <label class="form-check-label" for="answer_{{$j}}">
                        <input class="form-check-input" type="radio" name="question_{{$card.Id}}"
                            id="option_{{$o.Id}}" value="{{$o.Id}}"> {{$o.Text}}
                        </label>
                    </div>
                </li>
                </h5>
                {{end}}
            </ol>
        </div>
        {{end}}
        <div class="row fixed-bottom">
            <button id="js-btn-back" type="button" class="col btn btn-primary btn-lg invisible">Назад</button>
            <button id="js-btn-next" type="button" class="col btn btn-primary btn-lg">Вперед</button>
            <button id="js-btn-done" type="submit" class="col btn btn-success btn-lg d-none">Готово</button>
        </div>
    </form>
    </div>
    <script>
        const getAttrVals = function(card) {
            return Array.from(card.getAttribute("class").split(" "));
        }
        const changeProgress = function(cards, currentIndex) {
            const bar = document.getElementById("progress-bar");
            const max = cards.length - 1;
            const percent = currentIndex / max * 100;
            bar.setAttribute("style", `width: ${percent}%`)
        }
        const initProgress = function() {
            const cards = Array.from(document.getElementsByClassName("js-card"));
            changeProgress(
                cards,
                cards.findIndex(isCurrent)
            )
        }
        const hideCard = function(card) {
            const vals = getAttrVals(card);
            card.setAttribute(
                "class",
                vals.filter((val) => val !== "js-current").join(" ") + " d-none"
            );
        }
        const showCard = function(card) {
            vals = getAttrVals(card);
            card.setAttribute(
                "class",
                vals.filter((val) => val !== "d-none").join(" ") + " js-current"
            );
        }
        const goNext = function() {
            const cards = Array.from(document.getElementsByClassName("js-card"));
            const currentCard = cards.find(isCurrent)
            const currentIndex = cards.findIndex(isCurrent)
            if (currentIndex < cards.length - 1) {
                // Hide current card
                hideCard(currentCard);
                // Show next card and make it current
                const nextCard = cards[currentIndex + 1]
                showCard(nextCard);
                // Change progress
                changeProgress(cards, currentIndex + 1)
            }
            if (currentIndex === 0) {
                // Hide back button
                const backBtn = document.getElementById("js-btn-back");
                const vals = getAttrVals(backBtn);
                backBtn.setAttribute(
                    "class",
                    vals.filter((val) => val !== "invisible").join(" ")
                );
            }
            if (currentIndex === cards.length - 2) {
                // Replace next button with done button
                // Hide next button
                const nextBtn = document.getElementById("js-btn-next");
                let vals = getAttrVals(nextBtn);
                nextBtn.setAttribute("class", vals.join(" ") + " d-none");

                // Show done button
                const doneBtn = document.getElementById("js-btn-done");
                vals = getAttrVals(doneBtn);
                doneBtn.setAttribute(
                    "class",
                    vals.filter((val) => val !== "d-none").join(" ")
                );
            }
        }
        const goBack = function() {
            const cards = Array.from(document.getElementsByClassName("js-card"));
            const currentCard = cards.find(isCurrent)
            const currentIndex = cards.findIndex(isCurrent)
            if (currentIndex > 0) {
                // Hide current card
                hideCard(currentCard);
                // Show previous card
                const prevCard = cards[currentIndex - 1]
                showCard(prevCard);
                changeProgress(cards, currentIndex - 1);
            }
            if (currentIndex === 1) {
                // Hide back button
                const backBtn = document.getElementById("js-btn-back");
                const vals = getAttrVals(backBtn);
                backBtn.setAttribute("class", vals.join(" ") + " invisible");
            }
            if (currentIndex < cards.length) {
                // Replace done button with next button
                // Hide done button
                const doneBtn = document.getElementById("js-btn-done");
                let vals = getAttrVals(doneBtn);
                doneBtn.setAttribute("class", vals.join(" ") + " d-none");

                // Show next button
                const nextBtn = document.getElementById("js-btn-next");
                vals = getAttrVals(nextBtn);
                nextBtn.setAttribute(
                    "class",
                    vals.filter((val) => val !== "d-none").join(" ")
                );
            }
        }
        function isCurrent(card) {
            return card.getAttribute("class").includes("js-current");
        }
        document.addEventListener("DOMContentLoaded", initProgress);
        window.addEventListener(
            "keydown",
            (event) => {
                if (event.key === "ArrowRight") {goNext()}
            }
        )
        window.addEventListener(
            "keydown",
            (event) => {
                if (event.key === "ArrowLeft") {goBack()}
            }
        )
        document.getElementById("js-btn-next").addEventListener("click", goNext)
        document.getElementById("js-btn-back").addEventListener("click", goBack)
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous">
    </script>
</body>
</html>